<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oyun İndir Hub - Admin Paneli</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .sidebar {
            min-height: 100vh;
            background-color: #343a40;
        }
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.75);
        }
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
        }
        .main-content {
            padding: 20px;
        }
        .game-image-preview {
            max-width: 200px;
            max-height: 200px;
            margin-top: 10px;
        }
        .screenshot-thumbnail {
            width: 100px;
            height: 100px;
            object-fit: cover;
            margin-right: 10px;
            margin-bottom: 10px;
            position: relative;
        }
        .remove-screenshot {
            position: absolute;
            top: 0;
            right: 0;
            background: red;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
        }
    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 col-lg-2 d-md-block sidebar bg-dark collapse show">
            <div class="position-sticky pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" data-bs-toggle="tab" data-bs-target="#dashboard">
                            <i class="bi bi-speedometer2 me-2"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="tab" data-bs-target="#games">
                            <i class="bi bi-controller me-2"></i>Oyun Yönetimi
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="tab" data-bs-target="#categories">
                            <i class="bi bi-tags me-2"></i>Kategoriler
                        </a>
                    </li>
                    <li class="nav-item mt-3">
                        <a class="nav-link text-danger" href="#" id="logoutBtn">
                            <i class="bi bi-box-arrow-right me-2"></i>Çıkış Yap
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
            <div class="tab-content">
                <!-- Dashboard -->
                <div class="tab-pane fade show active" id="dashboard">
                    <h2 class="mb-4">Dashboard</h2>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card text-white bg-primary mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Toplam Oyun</h5>
                                    <p class="card-text display-4" id="totalGames">0</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-white bg-success mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Toplam Kategori</h5>
                                    <p class="card-text display-4" id="totalCategories">0</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Oyun Yönetimi -->
                <div class="tab-pane fade" id="games">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h2 class="h2">Oyun Yönetimi</h2>
                        <button class="btn btn-primary" id="addGameBtn">
                            <i class="bi bi-plus-circle"></i> Yeni Oyun Ekle
                        </button>
                    </div>

                    <!-- Oyun Listesi -->
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Oyun Adı</th>
                                <th>Kategoriler</th>
                                <th>İşlemler</th>
                            </tr>
                            </thead>
                            <tbody id="gameTableBody">
                            <!-- Oyunlar buraya eklenecek -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Oyun Ekleme/Düzenleme Formu (Modal) -->
                    <div class="modal fade" id="gameModal" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="gameModalTitle">Yeni Oyun Ekle</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="gameForm">
                                        <input type="hidden" id="gameId">
                                        <div class="mb-3">
                                            <label for="gameTitle" class="form-label">Oyun Adı</label>
                                            <input type="text" class="form-control" id="gameTitle" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="gameCategories" class="form-label">Kategoriler</label>
                                            <select class="form-select" id="gameCategories" multiple>
                                                <!-- Kategoriler buraya eklenecek -->
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="gameKeywords" class="form-label">Anahtar Kelimeler (virgülle ayırın)</label>
                                            <input type="text" class="form-control" id="gameKeywords">
                                        </div>
                                        <div class="mb-3">
                                            <label for="gameDescription" class="form-label">Kısa Açıklama</label>
                                            <textarea class="form-control" id="gameDescription" rows="3"></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label for="gameAbout" class="form-label">Oyun Hakkında Detaylar</label>
                                            <textarea class="form-control" id="gameAbout" rows="5"></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label for="gameImage" class="form-label">Kapak Resmi</label>
                                            <input type="file" class="form-control" id="gameImage" accept="image/*">
                                            <img id="gameImagePreview" class="game-image-preview d-none">
                                        </div>
                                        <div class="mb-3">
                                            <label for="gameScreenshots" class="form-label">Ekran Görüntüleri (Çoklu seçim)</label>
                                            <input type="file" class="form-control" id="gameScreenshots" multiple accept="image/*">
                                            <div id="screenshotsPreview" class="d-flex flex-wrap mt-2"></div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="gameSource" class="form-label">Kaynak</label>
                                            <input type="text" class="form-control" id="gameSource">
                                        </div>
                                        <div class="mb-3">
                                            <label for="gameDownloadUrl" class="form-label">İndirme Linki</label>
                                            <input type="url" class="form-control" id="gameDownloadUrl" required>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                                    <button type="button" class="btn btn-primary" id="saveGameBtn">Kaydet</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Kategori Yönetimi -->
                <div class="tab-pane fade" id="categories">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h2 class="h2">Kategori Yönetimi</h2>
                        <button class="btn btn-primary" id="addCategoryBtn">
                            <i class="bi bi-plus-circle"></i> Yeni Kategori Ekle
                        </button>
                    </div>

                    <!-- Kategori Listesi -->
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Kategori Adı</th>
                                <th>Oyun Sayısı</th>
                                <th>İşlemler</th>
                            </tr>
                            </thead>
                            <tbody id="categoryTableBody">
                            <!-- Kategoriler buraya eklenecek -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Kategori Ekleme/Düzenleme Formu (Modal) -->
                    <div class="modal fade" id="categoryModal" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="categoryModalTitle">Yeni Kategori Ekle</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="categoryForm">
                                        <input type="hidden" id="categoryId">
                                        <div class="mb-3">
                                            <label for="categoryName" class="form-label">Kategori Adı</label>
                                            <input type="text" class="form-control" id="categoryName" required>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                                    <button type="button" class="btn btn-primary" id="saveCategoryBtn">Kaydet</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Giriş Modalı -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="false" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Admin Girişi</h5>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="mb-3">
                        <label for="username" class="form-label">Kullanıcı Adı</label>
                        <input type="text" class="form-control" id="username" required>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Şifre</label>
                        <input type="password" class="form-control" id="password" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="loginBtn">Giriş Yap</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Veri depolama için localStorage kullanıyoruz
    const STORAGE_KEY = 'oyunIndirHubAdminData';

    // Varsayılan admin bilgileri
    const ADMIN_CREDENTIALS = {
        username: 'admin',
        password: 'admin123' // Gerçek uygulamada bu kadar basit bir şifre kullanmayın!
    };

    // Varsayılan veriler (eğer localStorage'da yoksa)
    const DEFAULT_DATA = {
        games: [],
        categories: [
            { id: 1, name: 'Aksiyon' },
            { id: 2, name: 'Macera' },
            { id: 3, name: 'Spor' },
            { id: 4, name: 'Strateji' },
            { id: 5, name: 'Yarış' }
        ],
        users: [ADMIN_CREDENTIALS]
    };

    // Uygulama durumu
    let state = {
        currentUser: null,
        editMode: false,
        currentGameId: null,
        currentCategoryId: null,
        gameImageFile: null,
        gameScreenshotsFiles: []
    };

    // DOM yüklendiğinde
    document.addEventListener('DOMContentLoaded', function() {
        initializeData();
        checkLogin();
        setupEventListeners();
    });

    // Verileri başlat
    function initializeData() {
        if (!localStorage.getItem(STORAGE_KEY)) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(DEFAULT_DATA));
        }
    }

    // Giriş kontrolü
    function checkLogin() {
        const data = getData();
        state.currentUser = data.currentUser || null;

        if (!state.currentUser) {
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            loginModal.show();
        } else {
            loadDashboard();
        }
    }

    // LocalStorage'dan verileri al
    function getData() {
        const data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || DEFAULT_DATA;
        return data;
    }

    // LocalStorage'a veri kaydet
    function saveData(data) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    // Event listener'ları kur
    function setupEventListeners() {
        // Giriş butonu
        document.getElementById('loginBtn').addEventListener('click', handleLogin);

        // Çıkış butonu
        document.getElementById('logoutBtn').addEventListener('click', handleLogout);

        // Oyun ekleme butonu
        document.getElementById('addGameBtn').addEventListener('click', () => {
            openGameModal();
        });

        // Kategori ekleme butonu
        document.getElementById('addCategoryBtn').addEventListener('click', () => {
            openCategoryModal();
        });

        // Oyun kaydetme butonu
        document.getElementById('saveGameBtn').addEventListener('click', saveGame);

        // Kategori kaydetme butonu
        document.getElementById('saveCategoryBtn').addEventListener('click', saveCategory);

        // Oyun resmi yükleme
        document.getElementById('gameImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                state.gameImageFile = file;
                const reader = new FileReader();
                reader.onload = function(event) {
                    const preview = document.getElementById('gameImagePreview');
                    preview.src = event.target.result;
                    preview.classList.remove('d-none');
                };
                reader.readAsDataURL(file);
            }
        });

        // Ekran görüntüleri yükleme
        document.getElementById('gameScreenshots').addEventListener('change', function(e) {
            const files = e.target.files;
            state.gameScreenshotsFiles = Array.from(files);
            const previewContainer = document.getElementById('screenshotsPreview');
            previewContainer.innerHTML = '';

            Array.from(files).forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const thumbDiv = document.createElement('div');
                    thumbDiv.style.position = 'relative';

                    const img = document.createElement('img');
                    img.src = event.target.result;
                    img.classList.add('screenshot-thumbnail');

                    const removeBtn = document.createElement('span');
                    removeBtn.classList.add('remove-screenshot');
                    removeBtn.innerHTML = '×';
                    removeBtn.addEventListener('click', () => {
                        state.gameScreenshotsFiles.splice(index, 1);
                        thumbDiv.remove();
                    });

                    thumbDiv.appendChild(img);
                    thumbDiv.appendChild(removeBtn);
                    previewContainer.appendChild(thumbDiv);
                };
                reader.readAsDataURL(file);
            });
        });
    }

    // Giriş işlemi
    function handleLogin() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        const data = getData();
        const user = data.users.find(u => u.username === username && u.password === password);

        if (user) {
            state.currentUser = user;
            data.currentUser = user;
            saveData(data);

            const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
            loginModal.hide();

            loadDashboard();
        } else {
            alert('Kullanıcı adı veya şifre hatalı!');
        }
    }

    // Çıkış işlemi
    function handleLogout() {
        const data = getData();
        data.currentUser = null;
        saveData(data);

        state.currentUser = null;
        checkLogin();
    }

    // Dashboard'ı yükle
    function loadDashboard() {
        const data = getData();

        // İstatistikleri güncelle
        document.getElementById('totalGames').textContent = data.games.length;
        document.getElementById('totalCategories').textContent = data.categories.length;

        // Oyun listesini yükle
        loadGameList();

        // Kategori listesini yükle
        loadCategoryList();
    }

    // Oyun listesini yükle
    function loadGameList() {
        const data = getData();
        const tableBody = document.getElementById('gameTableBody');
        tableBody.innerHTML = '';

        data.games.forEach(game => {
            const categories = game.categories.map(catId => {
                const category = data.categories.find(c => c.id === catId);
                return category ? category.name : '';
            }).filter(name => name !== '');

            const row = document.createElement('tr');
            row.innerHTML = `
                    <td>${game.id}</td>
                    <td>${game.title}</td>
                    <td>${categories.join(', ')}</td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-game" data-id="${game.id}">Düzenle</button>
                        <button class="btn btn-sm btn-danger delete-game" data-id="${game.id}">Sil</button>
                    </td>
                `;
            tableBody.appendChild(row);
        });

        // Düzenleme butonlarına event ekle
        document.querySelectorAll('.edit-game').forEach(btn => {
            btn.addEventListener('click', function() {
                const gameId = parseInt(this.getAttribute('data-id'));
                openGameModal(gameId);
            });
        });

        // Silme butonlarına event ekle
        document.querySelectorAll('.delete-game').forEach(btn => {
            btn.addEventListener('click', function() {
                const gameId = parseInt(this.getAttribute('data-id'));
                deleteGame(gameId);
            });
        });
    }

    // Kategori listesini yükle
    function loadCategoryList() {
        const data = getData();
        const tableBody = document.getElementById('categoryTableBody');
        tableBody.innerHTML = '';

        data.categories.forEach(category => {
            const gameCount = data.games.filter(game =>
                game.categories && game.categories.includes(category.id)
            ).length;

            const row = document.createElement('tr');
            row.innerHTML = `
                    <td>${category.id}</td>
                    <td>${category.name}</td>
                    <td>${gameCount}</td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-category" data-id="${category.id}">Düzenle</button>
                        <button class="btn btn-sm btn-danger delete-category" data-id="${category.id}">Sil</button>
                    </td>
                `;
            tableBody.appendChild(row);
        });

        // Düzenleme butonlarına event ekle
        document.querySelectorAll('.edit-category').forEach(btn => {
            btn.addEventListener('click', function() {
                const categoryId = parseInt(this.getAttribute('data-id'));
                openCategoryModal(categoryId);
            });
        });

        // Silme butonlarına event ekle
        document.querySelectorAll('.delete-category').forEach(btn => {
            btn.addEventListener('click', function() {
                const categoryId = parseInt(this.getAttribute('data-id'));
                deleteCategory(categoryId);
            });
        });
    }

    // Oyun modalını aç
    function openGameModal(gameId = null) {
        const modal = new bootstrap.Modal(document.getElementById('gameModal'));
        const form = document.getElementById('gameForm');
        const title = document.getElementById('gameModalTitle');
        const gameImagePreview = document.getElementById('gameImagePreview');
        const screenshotsPreview = document.getElementById('screenshotsPreview');

        // Formu temizle
        form.reset();
        gameImagePreview.src = '';
        gameImagePreview.classList.add('d-none');
        screenshotsPreview.innerHTML = '';

        state.editMode = gameId !== null;
        state.currentGameId = gameId;
        state.gameImageFile = null;
        state.gameScreenshotsFiles = [];

        // Kategorileri yükle
        const data = getData();
        const categorySelect = document.getElementById('gameCategories');
        categorySelect.innerHTML = '';

        data.categories.forEach(category => {
            const option = document.createElement('option');
            option.value = category.id;
            option.textContent = category.name;
            categorySelect.appendChild(option);
        });

        if (state.editMode) {
            title.textContent = 'Oyun Düzenle';
            const game = data.games.find(g => g.id === gameId);

            if (game) {
                document.getElementById('gameId').value = game.id;
                document.getElementById('gameTitle').value = game.title;
                document.getElementById('gameKeywords').value = game.keywords ? game.keywords.join(', ') : '';
                document.getElementById('gameDescription').value = game.description || '';
                document.getElementById('gameAbout').value = game.about || '';
                document.getElementById('gameSource').value = game.source || '';
                document.getElementById('gameDownloadUrl').value = game.downloadUrl || '';

                // Kategorileri seç
                if (game.categories) {
                    Array.from(categorySelect.options).forEach(option => {
                        if (game.categories.includes(parseInt(option.value))) {
                            option.selected = true;
                        }
                    });
                }

                // Resimleri yükle
                if (game.image) {
                    gameImagePreview.src = game.image;
                    gameImagePreview.classList.remove('d-none');
                }

                if (game.screenshots && game.screenshots.length > 0) {
                    game.screenshots.forEach((screenshot, index) => {
                        const thumbDiv = document.createElement('div');
                        thumbDiv.style.position = 'relative';

                        const img = document.createElement('img');
                        img.src = screenshot;
                        img.classList.add('screenshot-thumbnail');

                        const removeBtn = document.createElement('span');
                        removeBtn.classList.add('remove-screenshot');
                        removeBtn.innerHTML = '×';
                        removeBtn.addEventListener('click', () => {
                            game.screenshots.splice(index, 1);
                            thumbDiv.remove();
                        });

                        thumbDiv.appendChild(img);
                        thumbDiv.appendChild(removeBtn);
                        screenshotsPreview.appendChild(thumbDiv);
                    });
                }
            }
        } else {
            title.textContent = 'Yeni Oyun Ekle';
        }

        modal.show();
    }

    // Kategori modalını aç
    function openCategoryModal(categoryId = null) {
        const modal = new bootstrap.Modal(document.getElementById('categoryModal'));
        const form = document.getElementById('categoryForm');
        const title = document.getElementById('categoryModalTitle');

        // Formu temizle
        form.reset();

        state.editMode = categoryId !== null;
        state.currentCategoryId = categoryId;

        if (state.editMode) {
            title.textContent = 'Kategori Düzenle';
            const data = getData();
            const category = data.categories.find(c => c.id === categoryId);

            if (category) {
                document.getElementById('categoryId').value = category.id;
                document.getElementById('categoryName').value = category.name;
            }
        } else {
            title.textContent = 'Yeni Kategori Ekle';
        }

        modal.show();
    }

    // Oyun kaydet
    function saveGame() {
        const form = document.getElementById('gameForm');
        if (!form.checkValidity()) {
            form.classList.add('was-validated');
            return;
        }

        const data = getData();
        const categorySelect = document.getElementById('gameCategories');
        const selectedCategories = Array.from(categorySelect.selectedOptions).map(option => parseInt(option.value));

        const gameData = {
            title: document.getElementById('gameTitle').value,
            description: document.getElementById('gameDescription').value,
            about: document.getElementById('gameAbout').value,
            keywords: document.getElementById('gameKeywords').value.split(',').map(k => k.trim()),
            categories: selectedCategories,
            source: document.getElementById('gameSource').value,
            downloadUrl: document.getElementById('gameDownloadUrl').value,
            updatedAt: new Date().toISOString()
        };

        // Resimleri base64'e çevir (gerçek uygulamada sunucuya yüklenmeli)
        if (state.gameImageFile) {
            const reader = new FileReader();
            reader.onload = function(event) {
                gameData.image = event.target.result;
                finalizeGameSave(gameData, data);
            };
            reader.readAsDataURL(state.gameImageFile);
        } else if (state.editMode) {
            // Düzenleme modunda ve yeni resim yüklenmediyse, eski resmi koru
            const existingGame = data.games.find(g => g.id === state.currentGameId);
            if (existingGame && existingGame.image) {
                gameData.image = existingGame.image;
            }
            finalizeGameSave(gameData, data);
        } else {
            finalizeGameSave(gameData, data);
        }
    }

    function finalizeGameSave(gameData, data) {
        // Ekran görüntülerini işle
        if (state.gameScreenshotsFiles.length > 0) {
            gameData.screenshots = [];

            // Tüm ekran görüntülerini base64'e çevir
            const processNextScreenshot = (index) => {
                if (index >= state.gameScreenshotsFiles.length) {
                    completeGameSave(gameData, data);
                    return;
                }

                const file = state.gameScreenshotsFiles[index];
                const reader = new FileReader();
                reader.onload = function(event) {
                    gameData.screenshots.push(event.target.result);
                    processNextScreenshot(index + 1);
                };
                reader.readAsDataURL(file);
            };

            processNextScreenshot(0);
        } else if (state.editMode) {
            // Düzenleme modunda ve yeni ekran görüntüsü yüklenmediyse, eski görüntüleri koru
            const existingGame = data.games.find(g => g.id === state.currentGameId);
            if (existingGame && existingGame.screenshots) {
                gameData.screenshots = existingGame.screenshots;
            }
            completeGameSave(gameData, data);
        } else {
            completeGameSave(gameData, data);
        }
    }

    function completeGameSave(gameData, data) {
        if (state.editMode) {
            // Düzenleme modu
            const index = data.games.findIndex(g => g.id === state.currentGameId);
            if (index !== -1) {
                gameData.id = state.currentGameId;
                gameData.createdAt = data.games[index].createdAt;
                data.games[index] = gameData;
            }
        } else {
            // Yeni ekleme modu
            const newId = data.games.length > 0 ? Math.max(...data.games.map(g => g.id)) + 1 : 1;
            gameData.id = newId;
            gameData.createdAt = new Date().toISOString();
            data.games.push(gameData);
        }

        saveData(data);
        bootstrap.Modal.getInstance(document.getElementById('gameModal')).hide();
        loadGameList();
        updateDashboardStats();
    }

    // Kategori kaydet
    function saveCategory() {
        const form = document.getElementById('categoryForm');
        if (!form.checkValidity()) {
            form.classList.add('was-validated');
            return;
        }

        const data = getData();
        const categoryData = {
            name: document.getElementById('categoryName').value
        };

        if (state.editMode) {
            // Düzenleme modu
            const index = data.categories.findIndex(c => c.id === state.currentCategoryId);
            if (index !== -1) {
                categoryData.id = state.currentCategoryId;
                data.categories[index] = categoryData;
            }
        } else {
            // Yeni ekleme modu
            const newId = data.categories.length > 0 ? Math.max(...data.categories.map(c => c.id)) + 1 : 1;
            categoryData.id = newId;
            data.categories.push(categoryData);
        }

        saveData(data);
        bootstrap.Modal.getInstance(document.getElementById('categoryModal')).hide();
        loadCategoryList();
        updateDashboardStats();
    }

    // Oyun sil
    function deleteGame(gameId) {
        if (confirm('Bu oyunu silmek istediğinize emin misiniz?')) {
            const data = getData();
            data.games = data.games.filter(g => g.id !== gameId);
            saveData(data);
            loadGameList();
            updateDashboardStats();
        }
    }

    // Kategori sil
    function deleteCategory(categoryId) {
        const data = getData();

        // Bu kategoriyi kullanan oyunları kontrol et
        const gamesUsingCategory = data.games.filter(game =>
            game.categories && game.categories.includes(categoryId)
        );

        if (gamesUsingCategory.length > 0) {
            alert('Bu kategoriyi kullanan oyunlar var. Önce o oyunları düzenleyin veya silin.');
            return;
        }

        if (confirm('Bu kategoriyi silmek istediğinize emin misiniz?')) {
            data.categories = data.categories.filter(c => c.id !== categoryId);
            saveData(data);
            loadCategoryList();
            updateDashboardStats();
        }
    }

    // Dashboard istatistiklerini güncelle
    function updateDashboardStats() {
        const data = getData();
        document.getElementById('totalGames').textContent = data.games.length;
        document.getElementById('totalCategories').textContent = data.categories.length;
    }
</script>
</body>
</html>